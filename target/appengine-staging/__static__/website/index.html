<!DOCTYPE html>
<html id="html">

<head>
    <meta charset="UTF-8">
    <title>TinyPet</title>
    <meta name="google-signin-client_id"
        content="953149654950-sce7kiu7ahgnkpockg4nvcm1ek9no3gu.apps.googleusercontent.com">
        <meta name="google-signin-plugin_name"
       content="stop bugging me">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css">

    <link rel="stylesheet" href="style.css">

    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>

    <script src="https://unpkg.com/mithril/mithril.js"></script>

    <script src="https://apis.google.com/js/platform.js" async defer></script>
</head>

<body class="has-navbar-fixed-top">
    <script>
        var userConnecter = {
            id: null,
            prenom: "",
        };
        var currentURL = "/";
        var hostApi = "https://stone-notch-350213.appspot.com/_ah/api/myApi/v1";
        
        function getItemUpdatedInView(index) {

            switch (currentURL) {
                case "/": return Top10NewPetitions.list[index];
                case "/top100Signed": return Top10SignedPetitions.list[index];
                case "/MyPetitionCreated": return API_MyPetitionCreated.list[index];
            }
        }
        function UpdatedCardPetitionInView(index) {
            var cardView = document.getElementsByClassName("card slider")[index];

            cardView.getElementsByClassName("title")[0].innerHTML = Api_CrudPetition.item.titre;
            cardView.getElementsByClassName("subtitle")[0].innerHTML = Api_CrudPetition.item.description;
            cardView.getElementsByTagName("strong")[0].innerHTML = Api_CrudPetition.item.nbSignataire + " personnes sur ";
            cardView.getElementsByTagName("span")[0].innerHTML = Api_CrudPetition.item.objectifSignataire + " ont signé la pétition";
            alert("Pétition modifiée avec succès");
            
        }

        function scrollToTop() {
            window.scrollTo({ top: 0 });
        }

        function onSignIn(googleUser) {
            var profile = googleUser.getBasicProfile();
            userConnecter.id =parseInt(parseInt(profile.getId())/1000000000000);
            userConnecter.prenom = "" + profile.getGivenName();
            document.getElementById("login_google").classList.add('hide');
            document.getElementById("logout_google").classList.remove('hide');
        }
        function signOut() {
            var auth2 = gapi.auth2.getAuthInstance();
            auth2.signOut().then(function () {
                userConnecter.id = null;
                userConnecter.prenom = "";
                document.getElementById("login_google").classList.remove('hide');
                document.getElementById("logout_google").classList.add('hide');
                alert("Vous venez de vous déconnecter, pensez à raffraichir la page");
            });
        }
        function ShowCreateAndUpdatePetitionView(idItem = null, index = null) {
            if (idItem == null) {
                Api_CrudPetition.item = getPetitionObject();
                Api_CrudPetition.index = null;
            } else {
                API_infoPetition.index = index;
                API_infoPetition.loadPetition(idItem);
                Api_CrudPetition.index = index;

            }

            document.getElementById("CreateAndUpdatePetitionView").classList.add('is-active');
            document.getElementById("html").classList.add('is-clipped');
        }
        function HideCreateAndUpdatePetitionView() {
            document.getElementById("CreateAndUpdatePetitionView").classList.remove('is-active');
            document.getElementById("html").classList.remove('is-clipped');
            Api_CrudPetition.item = getPetitionObject();
        }
        function ShowDetailPetitionView() {
            document.getElementById("DetailPetitionView").classList.add('is-active');
            document.getElementById("html").classList.add('is-clipped');
        }
        function HideDetailPetitionView() {
            document.getElementById("DetailPetitionView").classList.remove('is-active');
            document.getElementById("html").classList.remove('is-clipped');
        }
        function getPetitionObject() {
            return item = {
                ID: null,
                theme: null,
                titre: null,
                description: null,
                date: null,
                proprietaire: userConnecter.id,
                nomProprietaire: userConnecter.prenom,
                nbSignataire: 0,
                objectifSignataire: 0,
                tag: null,
                tag_string: null,
            }
        }
        function convertToPetitionObject(ApiItem) {
            return item = {
                ID: ApiItem.key.name,
                theme: null,
                titre: item.properties.titre,
                description: null,
                date: null,
                proprietaire: null,
                nomProprietaire: userConnecter.prenom,
                nbSignataire: 0,
                objectifSignataire: 0,
                tag: null,
                tag_string: null,
            }
        }
        var Top10NewPetitions = {
            list: [],
            previous: ["0"],
            next: ["0"],
            loadList: function (idItem) {
                return m.request({
                    method: "GET",
                    url: hostApi + "/petition/news/top10/:id",
                    params: { id: idItem }
                })
                    .then(function (result) {

                        Top10NewPetitions.list = result.items;
                        scrollToTop();
                        var last = result.items[result.items.length - 1].key.name;
                        var previousNext = Top10NewPetitions.next[Top10NewPetitions.next.length - 1];
                        if (previousNext == undefined) {
                            previousNext = 0;
                        }
                        if (last > previousNext) {
                            Top10NewPetitions.previous.push(previousNext);
                            Top10NewPetitions.next.push(last);
                        }
                        if (last <= previousNext && Top10NewPetitions.previous.length > 2) {
                            Top10NewPetitions.previous.pop();
                            Top10NewPetitions.next.pop();
                        }
                    })
            }
        }

        var Top10SignedPetitions = {
            list: [],
            previous: "0",
            next: "0",
            loadList: function (idItem) {
                return m.request({
                    method: "GET",
                    url: hostApi + "/petition/signed/top10/:id",
                    params: { id: idItem }
                })
                    .then(function (result) {

                        Top10SignedPetitions.list = result.items;
                        scrollToTop();
                        Top10SignedPetitions.previous = Top10SignedPetitions.next;
                        Top10SignedPetitions.next = result.items[result.items.length - 1].key.name;

                    })
            }
        }
        var API_infoPetition = {
            index: 0,
            item: getPetitionObject(),
            loadPetition: function (idItem) {
                return m.request({
                    method: "GET",
                    url: hostApi + "/petition/info/:id",
                    params: { id: idItem }
                })
                    .then(function (result) {
                        API_infoPetition.item = result.properties
                        Api_CrudPetition.item = result.properties
                        Api_CrudPetition.item.ID = result.key.name
                    })
            }
        }
        var API_SignaturePetition = {
            isSigned: false,
            verifieSignature: function (idItem) {
                return m.request({
                    method: "GET",
                    url: hostApi + "/signature/verifie/:petitionID/:userID",
                    params: { petitionID: idItem, userID: userConnecter.id }
                })
                    .then(function (result) {
                        API_SignaturePetition.isSigned = result.properties.signed
                    })
            },
            addSignature: function (idItem) {
                return m.request({
                    method: "GET",
                    url: hostApi + "/signature/add/:petitionID/:userID",
                    params: { petitionID: idItem, userID: userConnecter.id }
                })
                    .then(function (result) {
                        alert(result.properties.message);
                        API_SignaturePetition.isSigned = true;
                        API_infoPetition.item.nbSignataire++;
                    })

            },
            deleteSignature: function (idItem) {
                return m.request({
                    method: "GET",
                    url: hostApi + "/signature/delete/:petitionID/:userID",
                    params: { petitionID: idItem, userID: userConnecter.id }
                })
                    .then(function (result) {
                        alert(result.properties.message);
                        API_SignaturePetition.isSigned = false;
                        API_infoPetition.item.nbSignataire--;
                    })
            }
        }
        var API_MyPetitionCreated = {
            list: [],
            previous: ["0"],
            next: ["0"],
            loadList: function (idItem) {

                return m.request({
                    method: "GET",
                    url: hostApi + "/petition/created/:userID/:last",
                    params: { userID: userConnecter.id, last: idItem }
                })
                    .then(function (result) {

                        API_MyPetitionCreated.list = result.items;
                        scrollToTop();
                        if (result.items.length == 0) {
                            alert("Vous n'avez pas encore créé de pétitions");
                        } else {
                            var last = result.items[result.items.length - 1].key.name;
                            var previousNext = API_MyPetitionCreated.next[API_MyPetitionCreated.next.length - 1];
                            if (previousNext == undefined) {
                                previousNext = 0;
                            }
                            if (last > previousNext) {
                                API_MyPetitionCreated.previous.push(previousNext);
                                API_MyPetitionCreated.next.push(last);
                            }
                            if (last <= previousNext && API_MyPetitionCreated.previous.length > 2) {
                                API_MyPetitionCreated.previous.pop();
                                API_MyPetitionCreated.next.pop();
                            }
                        }
                    })
            }
        }


        var Api_CrudPetition = {
            item: getPetitionObject(),
            index: null,
            previous: ["0"],
            next: ["0"],
            loadList: function (idItem) {

            },
            createPetition: function () {
                return m.request({
                    method: "POST",
                    url: hostApi + "/petition/add",
                    body: Api_CrudPetition.item,
                })
                    .then(function (result) {
                        alert("Création de la pétition");
                        if (currentURL != "/MyPetitionCreated") {
                            m.route.set("/MyPetitionCreated");
                        } else {
                            API_MyPetitionCreated.loadList(indexMyPetitionCreatedView);
                        }

                    })
            },
            updatePetition: function () {
                return m.request({
                    method: "POST",
                    url: hostApi + "/petition/update",
                    body: Api_CrudPetition.item,
                })
                    .then(function (result) {
                        Api_CrudPetition.item = result.properties;
                        Api_CrudPetition.item.ID = result.key.name;
                        UpdatedCardPetitionInView(Api_CrudPetition.index);
                    })
            },
            deletePetition: function (petitionID) {
                return m.request({
                    method: "GET",
                    url: hostApi + "/petition/delete/:ID",
                    params: { ID: petitionID }
                })
                    .then(function (result) {
                        alert("Suppression de la pétition effectuée");
                    })
            }

        }

        var indexTop10NewPetitionsView, indexTop10SignedPetitionsView,
            indexMyPetitionCreatedView, indexSearchPetitionView;
        var Top10NewPetitionsView = {
            oninit: function () {
                indexTop10NewPetitionsView = 0;
            },
            oncreate: function () {
                currentURL = "/";
                Top10NewPetitions.loadList(indexTop10NewPetitionsView);
            },
            view: function () {
                return [Top10NewPetitions.list.map(function (item, index) {
                    return m(cardPetition, { item: item, index: index })
                }), m(paginationTop10New)]
            }
        }

        var Top10SignedPetitionsView = {
            oninit: function () {
                indexTop10SignedPetitionsView = 0;
            },
            oncreate: function () {
                currentURL = "/Top100Signed";
                Top10SignedPetitions.loadList(indexTop10SignedPetitionsView);

            },
            view: function () {
                return [Top10SignedPetitions.list.map(function (item, index) {
                    return m(cardPetition, { item: item, index: index })
                }), m(paginationTop100Signed)]
            }
        }

        var MyPetitionCreatedView = {
            oninit: function () {
                indexMyPetitionCreatedView = 0;
            },
            oncreate: function () {
                currentURL = "/MyPetitionCreated";
                API_MyPetitionCreated.loadList(indexMyPetitionCreatedView);

            },
            view: function () {
                return [API_MyPetitionCreated.list.map(function (item, index) {
                    return m(cardPetition, { item: item, index: index })
                }), m(paginationMyPetitionCreated)]
            }
        }
    
        var DetailPetitionView = {
            view: function () {
                return m("div", { "id": "DetailPetitionView", "class": "modal full" },
                    [
                        m("div", { "class": "modal-background" }),
                        m("div", { "class": "modal-card" },
                            m("form", { "class": "form" },
                                [
                                    m("section", { "class": "modal-card-body" },
                                        m("div", { "class": "tile is-ancestor" },
                                            [
                                                m("div", { "class": "tile is-parent" },
                                                    [
                                                        m("div", { "class": "tile is-child box div_adapt" },
                                                            [
                                                                m("p", { "class": "has-text-centered mb-10" },
                                                                    [
                                                                        m("p", { "class": "title" }, "Titre : " + API_infoPetition.item.titre),
                                                                    ]
                                                                ),
                                                                m("p", { "class": "has-text-centered mb-10" },
                                                                    [
                                                                    m("p", API_infoPetition.item.description), m("br"),
                                                                    ]
                                                                ),
                                                                m("p", { "class": "title" },
                                                                    "Détails de la pétition : "
                                                                ),
                                                                m("p", { "class": "has-text-centered mb-10" },
                                                                    [
                                                                        m("span", { "class": "w-500" }, "Auteur : "),
                                                                        m("span", API_infoPetition.item.nomProprietaire), m("br")
                                                                    ]
                                                                ),
                                                                m("p", { "class": "has-text-centered mb-10" },
                                                                    [
                                                                        m("span", { "class": "w-500" }, "Thème : "),
                                                                        m("span", API_infoPetition.item.theme), m("br")
                                                                    ]
                                                                ),
                                                                m("p", { "class": "has-text-centered mb-10" },
                                                                    [
                                                                        m("span", { "class": "w-500" }, "Date de création : "),
                                                                        m("span", API_infoPetition.item.date), m("br")
                                                                    ]
                                                                ),
                                                                m("ul", { "class": "truncates" },
                                                                    [
                                                                        m("p", { "class": "has-text-centered mb-10" },
                                                                            [
                                                                                m("span", { "class": "w-500" },
                                                                                    " Tag : "
                                                                                ), API_infoPetition.item.tag == null ? "" : API_infoPetition.item.tag.map(function (item) {
                                                                                    return m("span", { "class": "tag is-rounded" },
                                                                                        item
                                                                                    )
                                                                                })
                                                                            ]
                                                                        ),
                                                                    ]
                                                                ), m("br"),
                                                                m("p", { "class": "title" }, "Signer la pétition"),
                                                                m("p", { "class": "has-text-centered mb-10" },
                                                                    [
                                                                        m("strong", API_infoPetition.item.nbSignataire + " personnes sur "),
                                                                        m("span", API_infoPetition.item.objectifSignataire + " ont signé la pétition"
                                                                        )
                                                                    ]
                                                                ),
                                                                m("p", {"class":"card-footer-item"}, 
                                                                    m("span",  m("a", {"class":"link", onclick: function(e) {
                                                                        e.preventDefault();
                                                                        if(API_infoPetition.item.proprietaire == userConnecter.id){
                                                                            alert("Vous ne pouvez pas signer vos propres petitions");
                                                                        } else {
                                                                            if(API_SignaturePetition.isSigned){
                                                                                API_SignaturePetition.deleteSignature(API_infoPetition.item.ID)
                                                                                                        
                                                                            }else if (userConnecter.id==null){
                                                                                alert("Vous devez être connecté pour signer une petition");
                                                                            } else{
                                                                                API_SignaturePetition.addSignature(API_infoPetition.item.ID)	
                                                                            }	            		
                                                                        }
                                                                    }}, API_SignaturePetition.isSigned?"Enlever ma signature":"Signer"))
                                                                )
                                                            ]
                                                        )
                                                    ]
                                                )
                                            ]
                                        )
                                    ),
                                    m("button", {
                                        onclick: function (e) {
                                            e.preventDefault();
                                            HideDetailPetitionView();
                                        }, "class": "modal-close is-large", "aria-label": "close"
                                    })
                                ]
                            )
                        )
                    ]
                )
            }

        }

        var CreateAndUpdatePetitionView = {
            view: function () {
                return m("div", { "id": "CreateAndUpdatePetitionView", "class": "modal" },
                    [
                        m("div", { "class": "modal-background" }),
                        m("div", { "class": "modal-card" },
                            m("form", {
                                "class": "form scroll-y", onsubmit: function (e) {
                                    e.preventDefault()
                                    if (Api_CrudPetition.item.ID == null) {
                                        Api_CrudPetition.createPetition();
                                    } else {
                                        Api_CrudPetition.updatePetition();
                                    }
                                    HideCreateAndUpdatePetitionView();

                                }
                            },
                                [
                                    m("header", { "class": "modal-card-head" },
                                        [
                                            m("p", { "class": "modal-card-title" },
                                                "Créer une petition"
                                            ),
                                            m("button", {
                                                onclick: function (e) {
                                                    e.preventDefault();
                                                    HideCreateAndUpdatePetitionView();
                                                }, "class": "delete", "aria-label": "close"
                                            })
                                        ]
                                    ),
                                    m("section", { "class": "modal-card-body" },
                                        [
                                            m("div", { "class": "field " },
                                                [
                                                    m("label", { "class": "label" },
                                                        "Titre"
                                                    ),
                                                    m("div", { "class": "control" },
                                                        m("input", {
                                                            "class": "input", "type": "text", "placeholder": "Indiquez le titre de votre pétition",
                                                            oninput: function (e) { Api_CrudPetition.item.titre = e.target.value },
                                                            value: Api_CrudPetition.item.titre
                                                        })
                                                    ),
                                                    m("p", { "class": "help  is-primary is-light" },
                                                        "*"
                                                    )
                                                ]
                                            ),
                                            m("div", { "class": "field " },
                                                [
                                                    m("label", { "class": "label" },
                                                        "Thème"
                                                    ),
                                                    m("div", { "class": "control" },
                                                        m("input", {
                                                            "class": "input", "type": "text", "placeholder": "Donnez le thème general",
                                                            oninput: function (e) { Api_CrudPetition.item.theme = e.target.value },
                                                            value: Api_CrudPetition.item.theme
                                                        })
                                                    ),
                                                    m("p", { "class": "help  is-primary is-light" },
                                                        "*"
                                                    )
                                                ]
                                            ),
                                            m("div", { "class": "field " },
                                                [
                                                    m("label", { "class": "label" },
                                                        "Tag"
                                                    ),
                                                    m("div", { "class": "control" },
                                                        m("input", {
                                                            "class": "input", "type": "text", "placeholder": "Indiquez vos tags, chaque tag doit etre terminer par un point virgule ;",
                                                            oninput: function (e) { Api_CrudPetition.item.tag_string = e.target.value },
                                                            value: Api_CrudPetition.item.tag_string
                                                        })
                                                    ),
                                                    m("p", { "class": "help  is-primary is-light" },
                                                        "* (un tag minimum requis)"
                                                    )
                                                ]
                                            ),
                                            m("div", { "class": "field " },
                                                [
                                                    m("label", { "class": "label" },
                                                        "Nombre de signatures visé"
                                                    ),
                                                    m("div", { "class": "control" },
                                                        m("input", {
                                                            "class": "input", "type": "number", "placeholder": "Indiquez le nombre de signatures que vous souhaitez atteindre",
                                                            oninput: function (e) { Api_CrudPetition.item.objectifSignataire = e.target.value },
                                                            value: Api_CrudPetition.item.objectifSignataire
                                                        })
                                                    )
                                                ]
                                            ),
                                            m("div", { "class": "field" },
                                                [
                                                    m("label", { "class": "label" },
                                                        "Description"
                                                    ),
                                                    m("div", { "class": "control" },
                                                        m("textarea", {
                                                            "class": "textarea ", "rows": "10", "placeholder": "Exprimez vous librement, et donnez tous les détails de votre pétition ",
                                                            oninput: function (e) { Api_CrudPetition.item.description = e.target.value },
                                                            value: Api_CrudPetition.item.description
                                                        })
                                                    ),
                                                    m("p", { "class": "help  is-primary is-light" },
                                                        "*"
                                                    )
                                                ]
                                            ),
                                            m("div", { "class": "field" },
                                                m("p", { "class": "help  is-primary is-light" },
                                                        "* : Champs obligatoires"
                                                )
                                            )
                                        ]
                                    ),
                                    m("footer", { "class": "modal-card-foot" },
                                        [
                                            m("button", { "class": "button is-primary save" },
                                                "Enregister"
                                            ),
                                            m("button", {
                                                onclick: function (e) {
                                                    e.preventDefault();
                                                    HideCreateAndUpdatePetitionView();
                                                }, "class": "button is-primary is-light cancel"
                                            },
                                                "Annuler")
                                        ]
                                    )
                                ]
                            )
                        )
                    ]
                )
            }
        }
        var Header = {
            view: function () {

                return [m("nav", { "class": "navbar is-fixed-top box", "role": "navigation", "aria-label": "main navigation" },
                    [
                        m("div", { "class": "navbar-brand" },
                            [
                                m("a", { "class": "", "href": "#" },
                                    m("img", { "src": "logo.png" })),
                                m("a", { "class": "navbar-burger", "role": "button", "aria-label": "menu", "aria-expanded": "false", "data-target": "navbarBasic" },
                                    [m("span", { "aria-hidden": "true" }), m("span", { "aria-hidden": "true" }), m("span", { "aria-hidden": "true" })])
                            ]
                        ),
                        m("div", { "class": "navbar-menu", "id": "navbarBasic" },
                            [
                                m("div", { "class": "navbar-start" },
                                    [
                                        m("a", {"class": "navbar-item fw-500", "href":"../index.html"}, "Revenir à la page d'accueil"),
                                        
                                        m(m.route.Link, {
                                            href: "/", onclick: function (e) {
                                                currentURL = '/';
                                            }, class: currentURL == "/" || currentURL == "/Top100Signed" ? "navbar-item fw-500 is-active" : "navbar-item fw-500"
                                        }, "Voir les pétitions"),
                                    ]
                                ),
                                m("div", { "class": "navbar-end" },

                                    m("a", {
                                        onclick: function (e) {
                                            if (userConnecter.id == null){
                                                alert("Veuillez vous connecter pour créer une pétition");
                                            } else {
                                                ShowCreateAndUpdatePetitionView();
                                            }
                                        }, "class": "navbar-item fw-500"
                                    }, " Lancer une petition "),

                                    m(m.route.Link, {
                                        href: "/MyPetitionCreated", onclick: function (e) {
                                            currentURL = '/MyPetitionCreated';
                                        }, "class": "navbar-item fw-500"
                                    }, "Mes petitions"),

                                    m(m.route.Link, {
                                        href: "/top100Signed", onclick: function (e) {
                                            currentURL = '/top100Signed';
                                        }, "class": "navbar-item fw-500"
                                    }, "Top des petitions"),

                                    m("div", { "class": "navbar-item" },
                                        m("div", { "class": "buttons" },
                                            [

                                                m("div", { "class": "buttons" }, []),

                                                m("div", { "id": "login_google", class: userConnecter.id == null ? "g-signin2" : "g-signin2 hide", "data-onsuccess": "onSignIn" }),

                                                m("a", {
                                                    "id": "logout_google", class: userConnecter.id == null ? "button is-light hide" : "button is-light", onclick: function (e) {
                                                        signOut();
                                                    }
                                                },
                                                    m("strong",
                                                        "Déconnexion"
                                                    )
                                                ),
                                            ]
                                        )
                                    )
                                )
                            ]
                        )
                    ]
                ),
                m(CreateAndUpdatePetitionView), m(DetailPetitionView)
                ]
            }

        }
        var TabParcourirPetition = {
            view: function () {
                return [
                    m("hr", { "class": "m-0 p-22" }),
                    m("br"),
                    m("h2", { "class": "title is-2 has-text-centered" },
                        "Voir les pétitions"
                    )
                ]
            }
        }
        var TabMyPetitionCreated = {
            view: function () {
                return [
                    m("hr", { "class": "m-0 p-22" }),
                    m("br"),
                    m("h2", { "class": "title is-2 has-text-centered" },
                        "Bienvenue, " + userConnecter.prenom.toLowerCase()
                    ),
                    m("div", { "class": "tabs is-centered m-0" },
                        m("ul",
                            [
                                m("li", { class: currentURL == "/MyPetitionCreated" ? "is-active" : "" }, m(m.route.Link, {
                                    href: "/MyPetitionCreated", onclick: function (e) {
                                        currentURL = '/MyPetitionCreated';
                                    }
                                }, "Pétitions créées"))

                            ]
                        )
                    )
                ]
            }
        }
        
        var TabDetailPetition = {
            view: function () {
                return [
                    m("hr", { "class": "m-0 p-22" }),
                    m("br"),
                    m("h2", { "class": "title is-2 has-text-centered" },
                        "Détails de la pétition"
                    ),
                    m("div", { "class": "tabs is-centered m-0" },
                        m("ul", { "class": "scroll-x" },
                            [
                                m("span", { "class": "w-500" },
                                    " Liste de tags : "
                                ), API_infoPetition.item.tag == null ? "" : API_infoPetition.item.tag.map(function (item) {
                                    return m("span", { "class": "tag is-rounded detPet" },
                                        item
                                    )
                                })
                            ]
                        )
                    )
                ]
            }
        }

        var cardPetition = {
            view: function (vnode) {
                var item = vnode.attrs.item;
                var index = vnode.attrs.index;

                return m("div", { class: item.deleted != null ? "card slider closed" : "card slider" },
                    [
                        m("div", { "class": "card-content" },
                            [
                                m("p", { "class": "title" }, item.properties.titre), m("br"),
                                m("p", { "class": "subtitle truncate" }, item.properties.description),
                                m("p", { "class": "has-text-centered" },
                                    [
                                        m("strong", item.properties.nbSignataire + " personnes sur "),
                                        m("span", item.properties.objectifSignataire + " ont signé la pétition")
                                    ]
                                )
                            ]
                        ),
                        m("footer", { "class": "card-footer" },
                            item.properties.proprietaire == userConnecter.id ? [
                                m("p", { "class": "card-footer-item" },
                                    m("span",
                                        m("a", {
                                            "class": "link",
                                            onclick: function (e) {
                                                item.deleted = true;
                                                Api_CrudPetition.deletePetition(item.key.name);

                                            }
                                        }, [
                                            m("span", { class: "" }, "Supprimer")
                                        ])
                                    )
                                ),
                                m("p", { "class": "card-footer-item" },
                                    m("span",
                                        m("a", {
                                            "class": "link",
                                            onclick: function (e) {
                                                ShowCreateAndUpdatePetitionView(item.key.name, index);
                                            }
                                        }, [
                                            m("span", { class: "" }, "Modifier")
                                        ])
                                    )
                                )
                            ] : "",
                            m("p", { "class": "card-footer-item" },
                                m("span",
                                    m("a", {
                                        "class": "link",
                                        onclick: function (e) {
                                            API_infoPetition.index = index;
                                            API_infoPetition.loadPetition(item.key.name)
                                            API_SignaturePetition.verifieSignature(item.key.name);
                                            ShowDetailPetitionView();
                                        }
                                    }, [
                                        m("span", { class: "" }, "Voir la pétition")
                                    ])
                                )
                            )
                        )
                    ]
                )
            }
        }
        var paginationTop10New = {
            view: function () {
                return Top10NewPetitions.list.length < 10 ? "" : m("nav", { "class": "pagination is-rounded", "role": "navigation", "aria-label": "pagination" },
                    [

                        m(m.route.Link, {
                            "class": "pagination-previous", href: "/", onclick: function (e) {
                                indexTop10NewPetitionsView = Top10NewPetitions.previous[Top10NewPetitions.previous.length - 2];
                                if (indexTop10NewPetitionsView == undefined) {
                                    indexTop10NewPetitionsView = 0;
                                }
                                Top10NewPetitions.loadList(indexTop10NewPetitionsView)

                            }
                        }, "Page précédente"),
                        m(m.route.Link, {
                            "class": "pagination-next", href: "/", onclick: function (e) {
                                indexTop10NewPetitionsView = Top10NewPetitions.next[Top10NewPetitions.next.length - 1];
                                Top10NewPetitions.loadList(indexTop10NewPetitionsView)
                            }
                        }, "Page suivante")
                    ]
                )
            }
        }

        var paginationTop100Signed = {
            view: function () {
                return Top10SignedPetitions.list.length < 10 ? "" : m("nav", { "class": "pagination is-rounded", "role": "navigation", "aria-label": "pagination" },
                    [

                        m(m.route.Link, {
                            "class": "pagination-previous", href: "/top100Signed", onclick: function (e) {
                                indexTop10SignedPetitionsView = Top10SignedPetitions.previous[Top10SignedPetitions.previous.length - 2];
                                Top10SignedPetitions.loadList(indexTop10SignedPetitionsView);

                            }
                        }, "Page précédente"),
                        m(m.route.Link, {
                            "class": "pagination-next", href: "/top100Signed", onclick: function (e) {
                                indexTop10SignedPetitionsView = Top10SignedPetitions.next[Top10SignedPetitions.next.length - 1];
                                Top10SignedPetitions.loadList(indexTop10SignedPetitionsView);
                            }
                        }, "Page suivante")
                    ]
                )
            }
        }

        var paginationMyPetitionCreated = {
            view: function () {
                return API_MyPetitionCreated.list.length < 10 ? "" : m("nav", { "class": "pagination is-rounded", "role": "navigation", "aria-label": "pagination" },
                    [

                        m(m.route.Link, {
                            "class": "pagination-previous", href: "/", onclick: function (e) {
                                indexMyPetitionCreatedView = API_MyPetitionCreated.previous[API_MyPetitionCreated.previous.length - 2];
                                if (indexMyPetitionCreatedView == undefined) {
                                    indexMyPetitionCreatedView = 0;
                                }

                                API_MyPetitionCreated.loadList(indexMyPetitionCreatedView)

                            }
                        }, "Page précédente"),
                        m(m.route.Link, {
                            "class": "pagination-next", href: "/", onclick: function (e) {
                                indexMyPetitionCreatedView = API_MyPetitionCreated.next[API_MyPetitionCreated.next.length - 1];
                                API_MyPetitionCreated.loadList(indexMyPetitionCreatedView)
                            }
                        }, "Page suivante")
                    ]
                )
            }
        }

        
        var Home = {
            view: function () {
                return [m(Header), m(TabParcourirPetition),
                m('div', { class: 'p-30 cendre' }, [
                    m(Top10NewPetitionsView)
                ])]
            }
        }
        var Top100Signed = {
            view: function () {
                return [m(Header), m(TabParcourirPetition),
                m('div', { class: 'p-30 cendre' }, [
                    m(Top10SignedPetitionsView)
                ])]
            }
        }

        var MyPetitionCreated = {
            view: function () {
                return [m(Header), m(TabMyPetitionCreated),
                m('div', { class: 'p-30 cendre' }, [
                    m(MyPetitionCreatedView)
                ])]
            }
        }
        var SearchPetition = {
            view: function () {
                return [m(Header), m(TabSearchPetition),
                m('div', { class: 'p-30 cendre' }, [
                    m(SearchPetitionView)
                ])]
            }
        }

        m.route(document.body, "/", {
            "/": Home,
            "/top100Signed": Top100Signed,
            "/MyPetitionCreated": MyPetitionCreated,
            "/SearchPetition": SearchPetition,
        })
    </script>
</body>

</html>